# Makefile for PSP MediaCenter
PSP_EBOOT = EBOOT.PBP
PSP_BIN = pspmc.elf

# EBOOT.PBP Settings, to save hand editing
PSP_EBOOT_SFO = media/PARAM.SFO
PSP_EBOOT_ICON = media/pspdev.png
PSP_EBOOT_TITLE = "PSP Media Center v0.71"
PSP_MSDIR = /cygdrive/I/PSP/GAME/PSPMC

# Work thru the codecs, and sort out settings
include codec.conf

# Now postprocess the values
PSP_OBJS := pspmc.o audiolib.o $(PSP_OBJS)
PSP_LIBS = -ldebug $(PLAYER_LIBS) -lc -lgcc -lm 
PSP_CFLAGS  := $(PSP_CFLAGS)
PSP_LDFLAGS := -v $(PSP_LDFLAGS) -Lnewlib-fix

all: deps release

deps: 
	make -C newlib-fix
release : header $(PSP_BIN)

clean:
	make -C newlib-fix clean
	rm -f *.elf *.o *.a $(PSP_EBOOT) $(PSP_BIN).fix release/* release/v1.0/* release/PSPMC/* release/PSPMC%/* codecincs.h $(PSP_OBJS) 2> /dev/null

cleanup:
	rm -f *.bak *.?~ mp3/*.bak mp3/*.?~ ogg/*.bak ogg/*.?~ mod/*.bak mod/*.?~ newlib-fix/*.?~ newlib-fix/*.bak

indent:
	indent -kr -l120  *.c *.h mp3/*.c mp3/*.h ogg/*.c ogg/*.h mod/*.c mod/*.h ogg/*.c ogg/*.h newlib-fix/*.c

# Generate the headerfile for included codecs
header:
	@echo Generating Header
	@rm -rf codecincs.h
	@echo /*Generated by makefile, do not hand edit!!!*/ > codecincs.h
	@echo -e $(PSP_CODEC_INCLUDE) >> codecincs.h

# Build a PBP file	
pbp:
	psp-strip --strip-all $(PSP_BIN).fix
	mksfo $(PSP_EBOOT_TITLE) $(PSP_EBOOT_SFO)
	pack-pbp release/v1.0/$(PSP_EBOOT) $(PSP_EBOOT_SFO) $(PSP_EBOOT_ICON) NULL NULL NULL NULL $(PSP_BIN).fix NULL
	pack-pbp release/PSPMC%/$(PSP_EBOOT) $(PSP_EBOOT_SFO) $(PSP_EBOOT_ICON) NULL NULL NULL NULL NULL NULL
	cp -rf $(PSP_BIN).fix release/PSPMC/EBOOT.PBP
	cp -rf Readme release/Readme.txt
	
# Upload PBP to MemoryStick	
upload10:
	cp release/v1.0/$(PSP_EBOOT) $(PSP_MSDIR)/EBOOT.PBP
upload15:
	cp release/PSPMC/EBOOT.PBP $(PSP_MSDIR)/EBOOT.PBP
	
include $(PSPSDK)/build/Makefile.pref
include $(PSPSDK)/build/Makefile.global

