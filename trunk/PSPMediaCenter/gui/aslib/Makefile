# Makefile for PSP MediaCenter as a library
PSPSDK=$(shell psp-config --pspsdk-path)
TARGET_LIB = libpspmc.a

# Work thru the codecs, and sort out settings
PSPMC_BASE = ../../
include $(PSPMC_BASE)codec.conf

# Now postprocess the values
OBJS := $(PSP_OBJS)
LIBS = $(PLAYER_LIBS) -lpspaudiolib  -lpspaudio -lpsphprm
# Take cflags and ldflags from codec script and add them in
CFLAGS  := -G0 $(PSP_CFLAGS) $(CFLAGS)
#CXXFLAGS := $(CFLAGS) -fno-exceptions -fno-rtti
CXXFLAGS := $(CFLAGS)
#ASFLAGS := $(CFLAGS)
LDFLAGS := $(LDFLAGS) $(PSP_LDFLAGS)
EXTRA_TARGETS := header 
#USE_PSPSDK_LIBC = 1

# This must be included here
include $(PSPSDK)/lib/build.mak

finallib: $(OBJS)
	$(AR) cru $(TARGET_LIB) $(OBJS) $(PSP_LIB_LDFLAGS)
	$(RANLIB) $(TARGET_LIB)
	$(AR) t $(TARGET_LIB)

# Generate the headerfile for included codecs
header:
	@echo Generating Header
	@rm -rf $(PSPMC_BASE)codecincs.h
	@echo /*Generated by makefile, do not hand edit!!!*/ > $(PSPMC_BASE)codecincs.h
	@echo -e $(PSP_CODEC_INCLUDE) >> $(PSPMC_BASE)codecincs.h


